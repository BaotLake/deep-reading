"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[759],{5759:function(e,t,n){function o(e){if(!e)return!1;if("#text"===e.nodeName)return!0;if("#comment"===e.nodeName)return!0;if(["TEXT","TSPAN"].includes(e.nodeName))return!0;if(["svg","IFRAME","HTML","BR","HR"].includes(e.nodeName))return!1;return!!window.getComputedStyle(e).display.startsWith("inline")}function r(e,t){var n,i,s;if("start"===t){if(e.previousSibling)return[e.previousSibling,o(e.previousSibling)];if(null===(n=e.parentNode)||void 0===n?void 0:n.previousSibling)return e.parentNode.previousSibling.lastChild?[e.parentNode.previousSibling.lastChild,o(e.parentNode)&&o(e.parentNode.previousSibling)&&o(null===(i=e.parentNode.previousSibling)||void 0===i?void 0:i.lastChild)]:[e.parentNode.previousSibling,o(e.parentNode)&&o(e.parentNode.previousSibling)];if(e.parentNode){let n=r(e.parentNode,t);return n[1]=n[1]&&o(e.parentNode),n}return[null,!1]}if("end"===t){if(e.nextSibling)return[e.nextSibling,o(e.nextSibling)];if(null===(s=e.parentNode)||void 0===s?void 0:s.nextSibling)return e.parentNode.nextSibling.firstChild?[e.parentNode.nextSibling.firstChild,o(e.parentNode)&&o(e.parentNode.nextSibling)&&o(e.parentNode.nextSibling.firstChild)]:[e.parentNode.nextSibling,o(e.parentNode)&&o(e.parentNode.nextSibling)];if(e.parentNode){let n=r(e.parentNode,t);return n[1]=n[1]&&o(e.parentNode),n}return[null,!1]}return[null,!1]}function i(e,t){let n=r(e,t);for(console.log("nextData -> ",n,t);n[0]&&"#text"!==n[0].nodeName;)if(0!==n[0].childNodes.length){if(["svg"].includes(n[0].nodeName))return n[0].previousSibling?[i(n[0].previousSibling,t)[0],!1]:n[0].parentNode?[i(n[0].parentNode,t)[0],!1]:[null,!1];if("start"!==t)if("end"!==t);else{let e=n[0].firstChild;n=[e,n[1]&&o(e)]}else{let e=n[0].lastChild;n=[e,n[1]&&o(e)]}}else{let o=r(n[0],t);o[1]=o[1]&&n[1],n=o,null===o[0]&&(console.error("newNext",o),console.log("node",e))}return n[0]&&"#text"!==n[0].nodeName&&console.error("An error occurred ad function: nextText ",n,e),n}function s(e,t,n){let o=[];const r=n||document,i=r.elementsFromPoint(e,t);for(let l of i){if(!r.contains(l))break;o.push(l),console.log("element: ",l,l.shadowRoot),l.shadowRoot&&o.push(...s(e,t,l.shadowRoot))}return o}function l(e,t){const n=d(e,t,"start"),o=d(e,t,"end"),r=new Range;return r.setStart(n[0],n[1]),r.setEnd(o[0],o[1]),r}function u(e,t){const n=c(e,t,"start"),o=c(e,t,"end"),r=new Range;return r.setStart(n[0],n[1]),r.setEnd(o[0],o[1]),r}function d(e,t,n){var o,r;let s=e,l=t;do{if("#text"===s.nodeName){const e=a(s,l,n);if(-1!==e){l=e;break}l="start"===n?0:(null===(o=s.textContent)||void 0===o?void 0:o.length)||0}const[e,t]=i(s,n);if(!e||!t)break;s=e,l="start"===n&&(null===(r=e.textContent)||void 0===r?void 0:r.length)||0}while(s);return[s,l]}function a(e,t,n){var o,r;if("start"===n){let n=((null===(o=e.textContent)||void 0===o?void 0:o.slice(Math.max(0,t-100),t))||"").match(/\W(\w*?)$/);return null===n?-1:t-n[1].length}if("end"===n){let n=((null===(r=e.textContent)||void 0===r?void 0:r.slice(t))||"").match(/^(\w*?)\W/);return null===n?-1:t+n[1].length}return-1}function c(e,t,n){var o,r;let s=e,l=t;do{if("#text"===s.nodeName){let e=!1,t=!1;const r=(null===(o=s.textContent)||void 0===o?void 0:o.length)||0;do{const o=f(s,l,n);l=-1!==o?o:"start"===n?0:r,e=-1!==o&&h(s,l),t=!e&&("start"===n?l>0:l<r),t&&(l+="start"===n?-1:1)}while(t);if(e)break}const[e,t]=i(s,n);if(!e||!t)break;s=e,l="start"===n&&(null===(r=e.textContent)||void 0===r?void 0:r.length)||0}while(s);return[s,l]}function f(e,t,n){var o,r;if("start"===n){let n=((null===(o=e.textContent)||void 0===o?void 0:o.slice(Math.max(0,t-500),t))||"").match(/[.?!\u3002\uff1f\uff01\f\t]([^.?!\u3002\uff1f\uff01\f\t]*?)$/);return null===n?-1:t-n[1].length}if("end"===n){let n=((null===(r=e.textContent)||void 0===r?void 0:r.slice(t))||"").match(/^([^.?!\u3002\uff1f\uff01\f\t]*?[.?!\u3002\uff1f\uff01\f\t])/);return null===n?-1:t+n[1].length}return-1}function h(e,t){var n,o;console.log("%c detect boundary","background: yellowgreen; padding: 5px; border-radius: 4px",(null===(n=e.textContent)||void 0===n?void 0:n.slice(0,t))+"|","|"+(null===(o=e.textContent)||void 0===o?void 0:o.slice(t)));const r=e.textContent||"";if(!r)return!1;const i=r.slice(Math.max(t-2,0),t+1);if(/\d\.\d/.test(i))return!1;const s=r.slice(Math.max(t-4,0),t+3);return console.log("ellipsis",s,/\.\.\./.test(s)),!/\.\.\./.test(s)}function v(e,t){var n;let o=s(e,t),r=[];for(let i of o)g(i)&&0!==(null===(n=i.textContent)||void 0===n?void 0:n.length)&&r.push(i);console.log("targetList",r,o);for(let i of r){let n=p(i,e,t);if(console.log("getTargetByPoint Target: ",n),n)return n}return null}function g(e){for(let t=0;t<e.childNodes.length;t++)if("#text"===e.childNodes[t].nodeName)return!0;return!1}function p(e,t,n){for(let o=0;o<e.childNodes.length;o++){let r=e.childNodes[o];if("#text"===r.nodeName){console.log("#text",r,o);let e=y(r,t,n);if(-1!==e)return[r,e]}}return null}function y(e,t,n){return function(e,t,n){var o;let r=(null===(o=e.textContent)||void 0===o?void 0:o.length)||0,i=new Range,s=[0,r];console.log("dichotomy find ...",s,t,n);let l=0;for(;s[1]-s[0]>=1;){0;let o=Math.round((s[0]+s[1])/2);i.setStart(e,o-1),i.setEnd(e,o);let r=i.getBoundingClientRect();if(console.log("position: ",l,r),s[1]-s[0]===1){let e=2;return r.top<n+e&&r.bottom>n-e&&r.right>t-e&&r.left<t+e?s[0]:-1}if(r.bottom<n)s[0]=o;else if(r.top>n)s[1]=o;else if(r.right<t)s[0]=o;else{if(!(r.left>t))return o-1;s[1]=o}}return-1}(e,t,n)}function b(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function l(e){try{u(o.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}u((o=o.apply(e,t||[])).next())}))}let m;n.d(t,{Xy:function(){return j},wc:function(){return O},SX:function(){return O},$H:function(){return k},pT:function(){return u},r_:function(){return l},$8:function(){return D},Wn:function(){return v},Lt:function(){return T}});function w(e){let t=e.target.result;console.log("handleUpgradeNeeded",e),e.oldVersion<1&&t.createObjectStore("reading",{autoIncrement:!0}),e.oldVersion<2&&t.createObjectStore("words",{keyPath:"word"}),e.oldVersion<3&&t.createObjectStore("doc",{keyPath:"url"}),e.oldVersion<4&&t.deleteObjectStore("doc")}function S(){return b(this,void 0,void 0,(function*(){if(m)return m;let e=indexedDB.open("history",4);return console.log("open historyDB"),e.onupgradeneeded=w,m=new Promise((t=>{e.onsuccess=e=>{let n=e.target.result;n.onerror=console.error,t(n)}})),m}))}const x={name:"deep-reading",version:1,openPromise:null};function N(e){return b(this,void 0,void 0,(function*(){const t=e.target.result;e.oldVersion<1&&(t.createObjectStore("words",{keyPath:"word"}),t.createObjectStore("read-history",{autoIncrement:!0}),t.createObjectStore("setting",{keyPath:"key"}))}))}function C(){return b(this,void 0,void 0,(function*(){const{name:e,version:t,openPromise:n}=x;if(n)return n;const o=indexedDB.open(e,t);return o.onupgradeneeded=N,x.openPromise=new Promise((e=>{o.onsuccess=()=>{const t=o.result;t.onerror=console.error,e(t)}})),function(){b(this,void 0,void 0,(function*(){const e=(yield S()).transaction("reading","readwrite").objectStore("reading"),t=e.openCursor(null,"next"),n=yield C();t.onsuccess=o=>{const r=t.result;if(r){console.log("migrate --\x3e> ",r.key);const t=r.value;n.transaction("read-history","readwrite").objectStore("read-history").add(t),e.delete(r.key),r.continue()}}}))}(),x.openPromise}))}class j{constructor(){}openDB(){return b(this,void 0,void 0,(function*(){return yield C()}))}search(e){return b(this,void 0,void 0,(function*(){if(!e)return;e=e.toLowerCase().trim();const t=yield this.queryDB(e);if(!1===t||t.timestamp<1635590345237){const n=yield this.request(e),o={star:t&&!!t.star,timestamp:Date.now()};if(n){const e=Object.assign(Object.assign({},n),o);return this.save(e,!1!==t),e}return{error:"Error"}}return t}))}getHistory(e){return b(this,void 0,void 0,(function*(){let t=(this.db||(yield this.openDB())).transaction("words","readonly").objectStore("words");return yield new Promise((n=>{let o=[];t.openCursor(null,"next").onsuccess=t=>{let r=t.target.result;if(r){if(o.push(r.value),o.length>=e)return n(o);r.continue()}else n(o)}}))}))}queryDB(e){return b(this,void 0,void 0,(function*(){let t=(this.db||(yield this.openDB())).transaction("words","readwrite").objectStore("words"),n=yield new Promise((n=>{const o=t.get(e);o.onsuccess=()=>{n(o.result)}}));return n||!1}))}save(e,t=!1){return b(this,void 0,void 0,(function*(){const n=this.db||(yield this.openDB());if(!e.word)return;let o=n.transaction("words","readwrite").objectStore("words");return t?o.put(e):o.add(e)}))}request(e){return b(this,void 0,void 0,(function*(){let t=yield function(e){return b(this,void 0,void 0,(function*(){const t=`https://1773134661611650.cn-shanghai.fc.aliyuncs.com/2016-08-15/proxy/wrp.LATEST/wrp_server/iciba?w=${e.toLowerCase()}`;return fetch(t,{}).then((e=>e.json()),(e=>e))}))}(e);if(!!t.answer){return{word:e,pronunciation:{symbol_am:t.ph_am,symbol_en:t.ph_en,symbol_other:t.ph_other,audio_am:t.audioUS,audio_en:t.audioUK,audio_other:t.audio},answer:t.answer}}return!1}))}}class k{constructor(){}translate(e){return b(this,void 0,void 0,(function*(){const t=new URLSearchParams;t.append("text",e);const n=yield function(e){return b(this,void 0,void 0,(function*(){return fetch("https://1773134661611650.cn-shanghai.fc.aliyuncs.com/2016-08-15/proxy/wrp.LATEST/wrp_server/alimt",{method:"POST",body:e}).then((e=>e.json()),(e=>e))}))}(t);return console.log("translate data",n),{original:e,translated:n.Data.Translated}}))}static detectLang(e){}}const P="read-history";class O{constructor(){this.data={}}openDB(){return b(this,void 0,void 0,(function*(){const e=yield C();return e.transaction(P,"readonly").objectStore(P).openCursor(null,"prev").onsuccess=e=>{let t=e.target.result;t&&(this.data=t.value,this.key=t.key)},this.db=e,e}))}getStore(e="readonly"){return b(this,void 0,void 0,(function*(){return(this.db||(yield this.openDB())).transaction(P,e).objectStore(P)}))}push(e){var t;return b(this,void 0,void 0,(function*(){if(e.href)return!this.db&&(yield this.openDB()),this.data&&this.isSamePage((null===(t=this.data)||void 0===t?void 0:t.href)||"",e.href)?this.update(e):this.create(e)}))}get(e){return b(this,void 0,void 0,(function*(){let t=yield this.getStore();return yield new Promise((n=>{let o=[];t.openCursor(null,"prev").onsuccess=t=>{let r=t.target.result;if(r){if(o.push(Object.assign(Object.assign({},r.value),{key:r.key})),o.length>=e)return n(o);r.continue()}else n(o)}}))}))}delete(e){return b(this,void 0,void 0,(function*(){(yield this.getStore("readwrite")).delete(e)}))}isSamePage(e,t){if(!e||!t)return!1;const n=/^https?:\/\/\w+/;if(n.test(e)&&n.test(t)){const n=new URL(e),o=new URL(t);return n.origin===o.origin&&n.pathname===o.pathname}return e===t}create(e){return b(this,void 0,void 0,(function*(){let t=yield this.getStore("readwrite");this.key=yield new Promise((n=>{t.add(Object.assign({},e)).onsuccess=t=>{this.data=Object.assign({},e),n(t.target.result)}}))}))}update(e){return b(this,void 0,void 0,(function*(){let t=yield this.getStore("readwrite");if(!this.key)return this.create(e);let n=yield new Promise((e=>{t.get(this.key).onsuccess=t=>{e(t.target.result)}})),o=Object.assign(Object.assign({},n),e);t.put(o,this.key).onsuccess=e=>{this.data=o,console.log("update success",e)}}))}}const _="setting";function B(e="readonly"){return b(this,void 0,void 0,(function*(){return(yield C()).transaction(_,e).objectStore(_)}))}function D(e){return b(this,void 0,void 0,(function*(){const t=(yield B()).get(e);return yield new Promise(((e,n)=>{t.onsuccess=()=>{e(t.result)},t.onerror=()=>{n()}}))}))}function T(e){return b(this,void 0,void 0,(function*(){(yield B("readwrite")).put(e)}))}}}]);